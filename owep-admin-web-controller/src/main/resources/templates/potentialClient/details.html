<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户列表</title>
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link rel="shortcut icon" th:href="@{favicon.ico}">
    <link href="../../static/css/bootstrap.min.css?v=3.3.6" th:href="@{/static/css/bootstrap.min.css(v=3.3.6)}"
          rel="stylesheet">
    <link href="../../static/css/font-awesome.css?v=4.4.0" th:href="@{/static/css/font-awesome.css(v=4.4.0)}"
          rel="stylesheet">
    <!--datapicker-->
    <link href="../../static/css/plugins/datapicker/datepicker3.css"
          th:href="@{/static/css/plugins/datapicker/datepicker3.css}" rel="stylesheet">

    <link href="../../static/css/animate.css" th:href="@{/static/css/animate.css}" rel="stylesheet">
    <link href="../../static/css/style.css?v=4.1.0" th:href="@{/static/css/style.css(v=4.1.0)}" rel="stylesheet">
    <style type="text/css">
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-7">
            <div class="row">
                <div class="col-sm-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <div class="row">
                                <div class="col-sm-2"><h5>基本信息</h5></div>
                                <div class="col-sm-6 col-sm-offset-4 text-right">
                                    <a href="javascript:void(0);" id="cancel" style="padding-right: 15px">取消</a>
                                    <a href="javascript:void(0);" id="complete">完成</a>
                                </div>
                                <div class="col-sm-2 col-sm-offset-8 text-right" style="display: none"><a
                                        href="javascript:void(0);" id="edit">编辑</a></div>
                            </div>

                        </div>
                        <div class="ibox-content">
                            <form class="form-horizontal" action="#" id="customerInfo">
                                <input th:value="${key}" type="hidden" name="id" id="clientId"/>
                                <div class="form-group">
                                    <label for="customerName" class="col-sm-2 control-label">客户姓名</label>
                                    <div class="col-sm-4">
                                        <input type="email" class="form-control" id="customerName"
                                               value="叶建雄" placeholder="请输入客户姓名">
                                    </div>
                                    <label for="specialty" class="col-sm-2 control-label">原本专业</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="软件技术" class="form-control" id="specialty"
                                               placeholder="请输入原本专业">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="customerGender" class="col-sm-2 control-label">客户性别</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="男" class="form-control" id="customerGender"
                                               placeholder="性别">
                                    </div>
                                    <label for="purpose" class="col-sm-2 control-label">意向专业</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="java开发" class="form-control" id="purpose"
                                               placeholder="Email">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="phone" class="col-sm-2 control-label">客户电话</label>
                                    <div class="col-sm-4">
                                        <input type="number" value="18807031363" class="form-control" id="phone"
                                               placeholder="电话">
                                    </div>
                                    <label for="channel" class="col-sm-2 control-label">渠道类型</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="招聘网站" class="form-control" id="channel"
                                               placeholder="渠道类型">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email" class="col-sm-2 control-label">客户邮箱</label>
                                    <div class="col-sm-4">
                                        <input type="email" value="1210736981@qq.com" class="form-control" id="email"
                                               placeholder="邮箱">
                                    </div>
                                    <label for="customerSource" class="col-sm-2 control-label">客户来源</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" id="customerSource"
                                               value="前程无忧" placeholder="Email">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="customerType" class="col-sm-2 control-label">客户类型</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="潜在客户" class="form-control" id="customerType"
                                               placeholder="未编辑">
                                    </div>
                                    <label for="customerBelong" class="col-sm-2 control-label">客户归属</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="潜在客户" class="form-control" id="customerBelong">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="interviewTime" class="col-sm-2 control-label">面试时间</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="2020-06-16" class="form-control" id="interviewTime">
                                    </div>
                                    <label for="divideClasses" class="col-sm-2 control-label">是否分班</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="是" class="form-control" id="divideClasses"
                                               placeholder="是否分班">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="evaluate" class="col-sm-2 control-label">专业评价</label>
                                    <div class="col-sm-10">
                                        <textarea id="evaluate" style="width: 100%" rows="6"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>款项信息</h5>
                        </div>
                        <div class="ibox-content">
                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">预付金额：</label>
                                    <div class="col-sm-4">
                                        <p id="advancePay"></p>
                                    </div>
                                    <label class="col-sm-2 control-label">贷款金额:</label>
                                    <div class="col-sm-4">
                                        <p id="loan"></p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="totalPay" class="col-sm-2 control-label">总金额：</label>
                                    <div class="col-sm-4">
                                        <p id="totalPay"></p>
                                    </div>
                                    <label for="repayment" class="col-sm-2 control-label">还款方式：</label>
                                    <div class="col-sm-4">
                                        <p id="repayment"></p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="loanStatus" class="col-sm-2 control-label">是否贷款：</label>
                                    <div class="col-sm-4">
                                        <p id="loanStatus"></p>
                                    </div>
                                    <label for="monthPay" class="col-sm-2 control-label">每月还款：</label>
                                    <div class="col-sm-4">
                                        <p id="monthPay"></p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-5">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <a href="">跟进记录</a>
                        </div>
                        <div class="" id="ibox-content">
                            <div id="vertical-timeline" class="vertical-container light-timeline">
                                <div id="content"></div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- 全局js -->
<script src="../../static/js/jquery.min.js?v=2.1.4" th:src="@{/static/js/jquery.min.js(v=2.1.4)}"></script>
<script src="../../static/js/bootstrap.min.js?v=3.3.6"
        th:src="@{/static/js/bootstrap.min.js(v=3.3.6)}"></script>
<!-- Data picker -->
<script src="../../static/js/plugins/datapicker/bootstrap-datepicker.js"
        th:src="@{/static/js/plugins/datapicker/bootstrap-datepicker.js}"></script>
<script src="../../static/js/plugins/datapicker/bootstrap-datepicker.zh-CN.min.js"
        th:src="@{/static/js/plugins/datapicker/bootstrap-datepicker.zh-CN.min.js}"></script>
<script>

    //当页面加载完成后向服务器发起请求 获取当前客户信息
    $(document).ready(function () {
        var id = $("#clientId").val()

        //显示基本信息和款项信息
        $.ajax({
            url: "/owep/client/findClientById",
            method: "GET",
            async: true,
            data: "id=" + id,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (data) {
                //给表单赋值
                $("#customerName").val(data.clientName);
                $("#specialty").val(data.major);  //原本专业
                data.gender == "1" ? $("#customerGender").val("男") : $("#customerGender").val("女");
                $("#purpose").val(data.profession);  //意向专业
                $("#phone").val(data.clientPhone);
                $("#channel").val(data.channelTypeName); //渠道类型
                $("#email").val(data.clientEmail);
                $("#customerSource").val(data.channelName);  //客户来源
                if (data.clientState == "0") {
                    //客户类型：0无意向、1已签约、2潜在客户、3标准客户
                    $("#customerType").val("无意向");
                } else if (data.clientState == "1") {
                    $("#customerType").val("已签约");
                } else if (data.clientState == "2") {
                    $("#customerType").val("潜在客户");
                } else if (data.clientState == "3") {
                    $("#customerType").val("标准客户");
                } else {
                    $("#customerType").val("客户类型异常");
                }
                $("#customerBelong").val(data.userName);  //客户归属
                $("#interviewTime").val(data.interviewTimeStart)
                data.isAssignClass == "0" ? $("#divideClasses").val("未分配") : $("#divideClasses").val("已分配")
                $("#evaluate").val(data.salsemanDescribe);

                $("#advancePay").html(data.advancePay);
                $("#loan").html(data.loan);
                $("#totalPay").html(data.totalPay);
                $("#repayment").html(data.repaymentPlan);
                data.loanStatus == "1" ? $("#loanStatus").html("贷款") : $("#loanStatus").html("未贷款");
                $("#monthPay").html(data.monthPay);

            }
        });

        //显示跟进记录
        $.ajax({
            url: "/owep/client/findClientNoteById",
            method: "GET",
            async: true,
            data: "id=" + id,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (data) {
                var temp = '';
                for (var i = 0; i < data.length; i++) {
                    temp = '<div class="vertical-timeline-block">\n' +
                        '                                    <div class="vertical-timeline-icon blue-bg">\n' +
                        '                                        <i class="fa fa-file-text"></i>\n' +
                        '                                    </div>\n\n' +
                        '                                    <div class="vertical-timeline-content">\n' +
                        '                                        <h2>客户类型</h2>\n' +
                        '                                        <p>#{clientState}</p>\n' +
                        '                                        <h2>客户说明</h2>\n' +
                        '                                        #{clientNote} <br>\n' +
                        '                                        <small>#{createTime}</small>\n' +
                        '                                    </span>\n' +
                        '                                    </div>\n' +
                        '                                </div>'
                    //给占位符赋值
                    //客户类型：0无意向、1已签约、2潜在客户、3标准客户
                    if (data[i].clientState == 0) {
                        temp = temp.replace("#{clientState}", "无意向");
                    } else if (data[i].clientState == 1) {
                        temp = temp.replace("#{clientState}", "已签约");
                    } else if (data[i].clientState == 2) {
                        temp = temp.replace("#{clientState}", "潜在客户");
                    } else if (data[i].clientState == 3) {
                        temp = temp.replace("#{clientState}", "标准客户");
                    }
                    temp = temp.replace("#{clientNote}", data[i].clientNote);
                    temp = temp.replace("#{createTime}", data[i].createTime);
                    //追加
                    $("#content").append(temp);
                }
            }
        })
    });

    //点击完成 修改客户信息
    $("#complete").click(function () {
        //获取表单数据
        var id = $("#clientId").val();
        var clientName = $("#customerName").val();
        var major = $("#specialty").val();  //原本专业
        $("#customerGender").val() == "男" ? gender = 1 : gender = 0;
        var profession = $("#purpose").val();  //意向专业
        var clientPhone = $("#phone").val();
        var channelTypeName = $("#channel").val(); //渠道类型
        var clientEmail = $("#email").val();
        var channelName = $("#customerSource").val();  //客户来源
        //客户类型的判断
        if ($("#customerType").val() == "无意向") {
            //客户类型：0无意向、1已签约、2潜在客户、3标准客户
            clientState = 0;
        } else if ($("#customerType").val() == "已签约") {
            clientState = 1;
        } else if ($("#customerType").val() == "潜在客户") {
            clientState = 2;
        } else if ($("#customerType").val() == "标准客户") {
            clientState = 3;
        } else {
            alert("客户类型异常！");
            return;
        }
        var userName = $("#customerBelong").val();
        var interviewTimeStart = $("#interviewTime").val();
        $("#divideClasses").val() == "已分配" ? isAssignClass = 1 : isAssignClass = 0;
        var salsemanDescribe = $("#evaluate").val();

        var formData = new FormData();
        formData.append("id",id);
        formData.append("clientName",clientName);
        formData.append("major",major);
        formData.append("gender",gender);
        formData.append("profession.profName",profession);
        formData.append("clientPhone",clientPhone);
        formData.append("channel.channelType.channelTypeName",channelTypeName);
        formData.append("clientEmail",clientEmail);
        formData.append("channel.channelName",channelName);
        formData.append("clientState",clientState);
        formData.append("user.userName",userName);
        formData.append("interviewTimeStart",interviewTimeStart);
        formData.append("isAssignClass",isAssignClass);
        formData.append("salsemanDescribe",salsemanDescribe);

        //异步保存数据
        $.ajax({
            url: "/owep/client/updateClient",
            method: "POST",
            async: true,
            data: formData,  //综合表单，使用formData来封装，不能用Serializable，否则无法提交
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (data) {
                alert(data.msg);
                window.location.reload();
            }

        })
        //将  取消和 完成隐藏
        $(".col-sm-6.col-sm-offset-4.text-right").css("display", "none");
        //将编辑按钮显示
        $(".col-sm-2.col-sm-offset-8.text-right").css("display", "inline");

        $(".form-control").css("border", "none").attr("readOnly", "false");
        $("#evaluate").css("border", "none").attr("readOnly", "false");


    });
    $("#cancel").click(function () {
        //将  取消和 完成隐藏
        $(".col-sm-6.col-sm-offset-4.text-right").css("display", "none");
        //将编辑按钮显示
        $(".col-sm-2.col-sm-offset-8.text-right").css("display", "inline");

        $(".form-control").css("border", "none").attr("readOnly", "false");
        $("#evaluate").css("border", "none").attr("readOnly", "false");
    });
    $("#edit").click(function () {
        $(".form-control").css("border", "1px solid #e5e6e7").removeAttr("readOnly");
        $("#evaluate").css("border", "1px solid #e5e6e7").removeAttr("readOnly");
        //将编辑按钮隐藏
        $(".col-sm-6.col-sm-offset-4.text-right").css("display", "inline");
        //将取消和 完成显示
        $(".col-sm-2.col-sm-offset-8.text-right").css("display", "none");

    });
</script>
<script>
    $('#interviewTime').datepicker({
        todayBtn: "linked",
        keyboardNavigation: false,
        forceParse: false,
        calendarWeeks: true,
        format: "yyyy-mm-dd",
        language: 'zh-CN',// 汉化
        autoclose: true
    });
</script>
<script>
    $(function () {
        // Local script for demo purpose only
        $('#lightVersion').click(function (event) {
            event.preventDefault()
            $('#ibox-content').removeClass('ibox-content');
            $('#vertical-timeline').removeClass('dark-timeline');
            $('#vertical-timeline').addClass('light-timeline');
        });

        $('#darkVersion').click(function (event) {
            event.preventDefault()
            $('#ibox-content').addClass('ibox-content');
            $('#vertical-timeline').removeClass('light-timeline');
            $('#vertical-timeline').addClass('dark-timeline');
        });

        $('#leftVersion').click(function (event) {
            event.preventDefault()
            $('#vertical-timeline').toggleClass('center-orientation');
        });


    });
</script>
</body>

</html>